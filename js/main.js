(()=>{"use strict";const t=new class{constructor(){this.update(),window.addEventListener("resize",(()=>this.update()),!1)}get safari(){return this._isSafari}get mobile(){return this._isMobile}get touchdevice(){return this._istouch}get vpw(){return this._vpw}get vph(){return this._vph}get retina(){return this._isRetina}update(){this._isSafari=!1,this._isChrome=!1,this._isMobile=window.matchMedia("only screen and (max-width: 760px)").matches,this._istouch="ontouchstart"in document.documentElement,this._vpw=window.innerWidth,this._vph=window.innerHeight,this._isRetina=window.devicePixelRatio>1;var t=navigator.userAgent.toLowerCase();-1!=t.indexOf("safari")&&(t.indexOf("chrome")>-1?this._isChrome=!0:this._isSafari=!0)}};const i=new class{constructor(t=60){this._counter=0,this._fps=60,this._dt=0,this._lastTime=Date.now(),this._animate=!1,this._requestFrameId=void 0,this._subscribers=[]}start(){this._animate=!0,this._requestFrameId||(this._requestFrameId=window.requestAnimationFrame((()=>this.frame())),this._lastTime=Date.now())}stop(){this._animate=!1,this._requestFrameId&&(window.cancelAnimationFrame(this._requestFrameId),this._requestFrameId=void 0)}animate(t){this._subscribers.includes(t)||(this._subscribers.push(t),this._animate||this.start())}release(t){if(this._subscribers.includes(t)){let s=0;for(var i of this._subscribers){if(i===t)break;s++}this._subscribers.splice(s,1)}}frame(){var t=Date.now(),i=t-this._lastTime;for(var s of(this._counter++,this._subscribers))s.update(i);0!=this._subscribers.length?(this._animate&&(this._requestFrameId=window.requestAnimationFrame((()=>this.frame()))),this._lastTime=t):this.stop()}};class s{constructor(t,i,s,e,n,h="ease-in-out"){this._target=t,this._property=i,this._srcVal=s,this._dstVal=e,this._offset=this._dstVal-this._srcVal,this._duration=n,this._lastTime=0,this._isRunning=!1,this._isDone=!1,this.easing=h}stop(){this._isRunning&&(this._isRunning=!1,this._lastTime=0)}update(t){if(this._isRunning||(this._isRunning=!0,this._isDone=!1,this._lastTime=0),Math.abs(this._target[this._property]-this._dstVal)<.001)return this._isDone=!0,void(this._target[this._property]=this._dstVal);this._lastTime+=t/1e3;let i=this._lastTime;i>this._duration&&(i=this._duration);let s=0;s="ease-in"==this.easing?this.CubicEaseIn(i,this._srcVal,this._offset,this._duration):"ease-out"==this.easing?this.CubicEaseOut(i,this._srcVal,this._offset,this._duration):"quart-ease-out"==this.easing?this.QuartEaseOut(i,this._srcVal,this._offset,this._duration):"quart-ease-in-out"==this.easing?this.QuartEaseInOut(i,this._srcVal,this._offset,this._duration):"quint-ease-out"==this.easing?this.QuintEaseOut(i,this._srcVal,this._offset,this._duration):"ease-in-out"==this.easing?this.CubicEaseInOut(i,this._srcVal,this._offset,this._duration):"sine-ease-in-out"==this.easing?this.SineEaseInOut(i,this._srcVal,this._offset,this._duration):this.Linear(i,this._srcVal,this._offset,this._duration),this._target[this._property]=s}get isRunning(){return this._isRunning}get isDone(){return this._isDone}get duration(){return this._duration}Linear(t,i,s,e){return s*t/e+i}SineEaseIn(t,i,s,e){return-s*Math.cos(t/e*(Math.PI/2))+s+i}SineEaseOut(t,i,s,e){return s*Math.sin(t/e*(Math.PI/2))+i}SineEaseInOut(t,i,s,e){return-s/2*(Math.cos(Math.PI*t/e)-1)+i}CubicEaseIn(t,i,s,e){return s*(t/=e)*t*t+i}CubicEaseOut(t,i,s,e){return s*((t=t/e-1)*t*t+1)+i}CubicEaseInOut(t,i,s,e){return(t/=e/2)<1?s/2*t*t*t+i:s/2*((t-=2)*t*t+2)+i}QuartEaseIn(t,i,s,e){return s*(t/=e)*t*t*t+i}QuartEaseOut(t,i,s,e){return-s*((t=t/e-1)*t*t*t-1)+i}QuartEaseInOut(t,i,s,e){return(t/=e/2)<1?s/2*t*t*t*t+i:-s/2*((t-=2)*t*t*t-2)+i}QuintEaseIn(t,i,s,e){return s*(t/=e)*t*t*t*t+i}QuintEaseOut(t,i,s,e){return s*((t=t/e-1)*t*t*t*t+1)+i}QuintEaseInOut(t,i,s,e){return(t/=e/2)<1?s/2*t*t*t*t*t+i:s/2*((t-=2)*t*t*t*t+2)+i}}const e=new class{constructor(){this._position=0,this._easing=null,this.reset()}get position(){return this._position}set position(t){t!=this._position&&(window.scrollTo(0,t),this._position=t)}reset(){this._position=window.scrollY||window.pageYOffset}scrollTo(t,e=.8,n="quart-ease-in-out"){this.reset(),this._position!=t&&(this._easing=new s(this,"position",this._position,t,e,n),i.animate(this))}update(t){null!=this._easing&&null!=this._easing&&(this._easing.update(t),this._easing.isDone&&i.release(this))}};class n{constructor(t){this._onEventCall=t}post(t,i=""){null!=this._onEventCall&&(""==i?this._onEventCall(t):this._onEventCall(t+"."+i))}}class h{constructor(t){this._eventListener=t,this._mousePos=[],this._mouseIsDown=!1,this._scrollPos=0,this._lastScrollPos=0,this._scrollUpDistance=0,this._scrollUp=!1,this._isTouch=!1,this._isTouchDown=!1,this._didTouchMove=!1,this._touchY=0,this.isBottom=!1,this._resizeThrottle=null,this._scrollThrottle=null,this._docHeight=0,window.addEventListener("mousemove",(t=>this.mouseMove(t))),window.addEventListener("mousedown",(t=>this.mouseDown(t))),window.addEventListener("mouseup",(t=>this.mouseUp(t))),window.addEventListener("touchstart",(t=>this.touchStart(t))),window.addEventListener("touchmove",(t=>this.touchMove(t))),window.addEventListener("touchend",(t=>this.touchEnd(t))),window.addEventListener("scroll",(t=>this.onScroll(t))),window.addEventListener("resize",(t=>this.onResize(t))),window.addEventListener("load",(t=>this.onResize(t))),this.onResize(),this.updateScrollPos()}onResize(i){if(null==this._resizeThrottle){t.update();var s=document.body,e=document.documentElement;this._docHeight=Math.max(s.scrollHeight,s.offsetHeight,e.clientHeight,e.scrollHeight,e.offsetHeight),this._resizeThrottle=setTimeout((()=>{this._eventListener.didResize(this),this._resizeThrottle=null}),500)}}onScroll(t){this._isTouch=!1,this.updateScrollPos(),null==this._scrollThrottle&&(this._eventListener.onScroll(this),this._scrollThrottle=setTimeout((()=>{this._eventListener.onScroll(this),this._scrollThrottle=null}),100))}updateScrollPos(){this._scrollPos=window.scrollY||window.pageYOffset||document.body.scrollTop+(document.documentElement&&document.documentElement.scrollTop||0);let i=this._docHeight-t.vph;this.isBottom=this._scrollPos>=i-50,this._scrollPos<i&&this._lastScrollPos>this._scrollPos?this._scrollUpDistance+=this._lastScrollPos-this._scrollPos:this._scrollUpDistance=0,this._scrollUp=this._scrollUpDistance>0,this._lastScrollPos=this._scrollPos}mouseMove(t){this._isTouch=!1;var i=t.clientX,s=t.clientY;this._mousePos=[i,s],this._eventListener.onMouseMove(this)}mouseDown(t){this._isTouch=!1,this._mouseIsDown=!0}mouseUp(t){this._isTouch=!1,this._mouseIsDown=!1}touchStart(t){this._isTouchDown=!0,this._didTouchMove=!1,this._eventListener.onTouchStart(this),this._touchY=t.touches[0].clientY}touchEnd(t){this._isTouchDown=!1,this._touchY<150&&(this._didTouchMove=!0),this._eventListener.onTouchEnd(this)}touchMove(t){this._touchY=t.touches[0].clientY,this._didTouchMove=!0}get scrollPos(){return this._scrollPos}get isScrollingUp(){return this._scrollUp}get isTouchDown(){return this._isTouchDown}get didTouchMove(){return this._didTouchMove}get isTouch(){return this._isTouch}get mousePos(){return this._mousePos}get mouseIsDown(){return this._mouseIsDown}get docHeight(){return this._docHeight}isScrollToBottom(i=0){return this._scrollPos+t.vph>=this._docHeight-i}}class o{constructor(t){if(this._containerElement=t,this.reveals=null,"IntersectionObserver"in window){let t={threshold:[.01,.1,.25,.5]};this.intersectionObserver=new IntersectionObserver((t=>this.intersectionHit(t)),t)}else this.intersectionObserver=null}init(){this.initReveal(),this.initLazyload()}initReveal(){this.reveals=Array.from(document.getElementsByClassName("reveal")),Array.from(this._containerElement.getElementsByClassName("content")).forEach((t=>{if(t.classList.contains("casestudy")){Array.from(t.getElementsByTagName("img")).forEach((t=>{t.classList.add("reveal"),this.reveals.push(t)}))}})),Array.from(document.getElementsByTagName("video")).forEach((t=>{t.classList.add("reveal"),this.reveals.push(t)})),this.reveals.forEach((t=>{!this.isInViewport(t)&&"IntersectionObserver"in window?(t.classList.remove("appear"),this.intersectionObserver.observe(t)):"IMG"!=t.tagName||t.complete?t.classList.add("appear"):t.onload=()=>{t.classList.add("appear")}}))}initLazyload(){this.lazies=Array.from(document.getElementsByClassName("lazy")),this.lazies.forEach((t=>{!this.isInViewport(t)&&"IntersectionObserver"in window?(t.classList.remove("appear"),this.intersectionObserver.observe(t)):this.lazyLoad(t)}))}lazyLoad(t){t.hasAttribute("data-src")&&(this.setResponsiveImgSrc(t,t.dataset.src,t.dataset.srcset),t.onload=()=>{t.classList.add("appear")},t.classList.remove("lazy"),t.removeAttribute("data-src"),t.removeAttribute("data-srcset"))}setResponsiveImgSrc(i,s,e){let n=e.split(",");n.length>1&&t.mobile?i.src=n[0].replace(" 2x","").replace(" 1x","").trim():(i.src=s,i.srcset=e)}intersectionHit(t){t.forEach((t=>{if(t.intersectionRatio>0){let i=t.target;"VIDEO"!=i.tagName||i.classList.contains("appear")?i.classList.contains("lazy")&&this.lazyLoad(i):(i.playing||(i.controls=!0,i.autoplay=!0,i.muted=!0,i.play()),i.classList.add("appear")),this.intersectionObserver.unobserve(i)}}))}isInViewport(t){var i=t.getBoundingClientRect();return i.top>=0&&i.top<=(window.innerHeight||document.documentElement.clientHeight)||i.bottom>=0&&i.bottom<=(window.innerHeight||document.documentElement.clientHeight)}}class a{constructor(t){this.eventbus=t,this.button=null,this.overlay=null,this.shadowpanel=null,this.shadow=null,this.footer=null,this._position=0,this._top=0,this._easing=null,this._transitionTime=.5,this._transitionFunction="quart-ease-out",this._vpHeight=900,this._isOk=!1,this._canAnimate=!0,this._hintSize=96,this._loading=!1,this._embeded=!1}init(t){this.button=document.getElementById("aboutbutton"),this.overlay=document.getElementById("aboutoverlay"),this.overlay.style.display="none",this.footer=document.getElementsByTagName("footer")[0],this._vpHeight=t,0==this.overlay.childNodes.length?(this.shadow=document.createElement("div"),this.shadow.id="shadow",this.overlay.appendChild(this.shadow),this.panel=document.createElement("div"),this.panel.id="about",this.overlay.appendChild(this.panel)):this.panel=document.getElementById("about"),this.panel.addEventListener("scroll",(t=>this.onScroll(t))),this.embed=this.overlay.classList.contains("embed"),this._isOk=!0,this.position>this._vpHeight/2?this.lock():this.hide(),this.resetTop()}resetTop(){let t=window.pageYOffset||document.documentElement.scrollTop;this._top=t+this.overlay.getBoundingClientRect().top-.7*this._vpHeight,this._embeded||(this._top=t+this.footer.getBoundingClientRect().top-1*this._vpHeight)}set position(t){this._isOk&&(this._position=Math.min(this._vpHeight,t),this._position=Math.max(0,this._position),this.overlay.style.display=this._position>0||this._embeded?"block":"none",this.shadow.style.opacity=this._position<=this._hintSize?0:(this._position-this._hintSize)/(this._vpHeight-this._hintSize),this.panel.style.transform="translateY(-"+this._position+"px)")}set embed(t){this._embeded=t,this._embeded?(this.overlay.classList.add("embed"),this.panel.style.top="0px",this.panel.style.height="auto",this.overlay.style.display="block"):(this.overlay.classList.remove("embed"),this.panel.style.top=this._vpHeight+"px",this.panel.style.height=this._vpHeight+"px"),this.resetTop()}get embed(){return this._embeded}get top(){return this._top}get height(){return this._vpHeight}get position(){return this._position}set canAnimate(t){this._canAnimate=t}get canAnimate(){return this._canAnimate}isVisible(){if(this._embeded){return(window.scrollY||window.pageYOffset||document.body.scrollTop+(document.documentElement&&document.documentElement.scrollTop||0))>=this._top}return this.position>0}lock(){if(this._isOk&&!this._embeded){if(this.load(),this._position<this._vpHeight){let t=this._position>0?"quart-ease-in-out":this._transitionFunction;this._easing=new s(this,"position",this._position,this._vpHeight,this._transitionTime,t),i.animate(this)}else this.position=this._vpHeight;this.eventbus.post("nav","backbutton"),this.panel.classList.remove("noscroll")}}hide(t=!0){this._isOk&&!this._embeded&&(t&&this._canAnimate&&this._position>0?(this._easing=new s(this,"position",this._position,0,this._transitionTime,this._transitionFunction),i.animate(this)):this.position=0,this.panel.scrollTop=0,this.eventbus.post("nav","nobackbutton"))}update(t){this._canAnimate?null!=this._easing&&null!=this._easing&&(this._easing.update(t),this._easing.isDone&&i.release(this)):i.release(this)}onScroll(t){this.panel.scrollTop>150?this.eventbus.post("nav","hide"):this.eventbus.post("nav","show")}load(){return this.panel.childNodes.length>0||this._loading?null:(this._loading=!0,new Promise(((t,i)=>{fetch("/about.html",{headers:{"Content-Type":"text/html; charset=utf-8"}}).then((t=>t.text())).then((i=>{var s=(new DOMParser).parseFromString(i,"text/html");null==this.panel&&t(1);var e=s.getElementsByClassName("content")[0];e.classList.add("hide"),this.panel.append(e),setTimeout((()=>{e.classList.remove("hide")}),100),this._loading=!1,t(1)})).catch((t=>{this._loading=!1,i(Error("Error while fetching about.html "+t))}))})))}removeContent(){for(;this.panel.firstChild;)this.panel.removeChild(this.panel.firstChild)}}const r={Hidden:Symbol("hidden"),Preview:Symbol("preview"),Visible:Symbol("visible")};Object.freeze(r);class l{constructor(){this._elem=null,this._state=r.Visible,this._index=!1,this._encore=0,this.init()}init(){this._trigger=t.mobile?36:96,this._indexTrigger=t.mobile?250:600,this._elem=document.getElementsByTagName("header")[0],this._items=Array.from(this._elem.getElementsByTagName("h4")),this._links=Array.from(this._elem.getElementsByTagName("a")),this._scrollUpDistance=0,this._lastScrollPos=0}get element(){return this._elem}update(i){i<=this._lastScrollPos?this._scrollUpDistance+=this._lastScrollPos-i:this._scrollUpDistance=0;let s=this._scrollUpDistance>400;i>this._encore+192&&this._index?this.hide():i>this._encore&&this._index&&!s?(this.setBackButton(!t.mobile),this.full()):i>this._trigger&&!s&&(!this._index||t.mobile)?(this.setBackButton(!1),this.hide()):i>this._trigger&&s?(this.setBackButton(!1),this.preview()):(this.setBackButton(!1),this._index?this.preview():this.full()),this._lastScrollPos=i}set indexMode(t){let i=t;this._index!=i&&(this._index=i)}get indexMode(){return this._index}setBackButton(i=!0){this._links[this._links.length-1].innerHTML=i?this._index&&!t.mobile?"↑Back":"↓Back":"About"}set encore(t){this._encore=t}hide(){this._state!=r.Hidden&&(this._state=r.Hidden,this._elem.classList.add("hide"),this._elem.classList.remove("preview"))}preview(){this._state!=r.Preview&&(this._state=r.Preview,this._elem.classList.add("hide"),this._elem.classList.add("preview")),this._elem.style.opacity=1}full(){this._state!=r.Visible&&(this._state=r.Visible,this._elem.classList.remove("preview"),this._elem.classList.remove("hide")),this._elem.style.opacity=1}light(){this._elem.classList.add("light")}unlight(){this._elem.classList.remove("light")}}function d(t){let i=function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])}(t);if(0==i)return t;let s=1/i;return new Float32Array([t[0]*s,t[1]*s,t[2]*s])}function c(t,i){return new Float32Array([t[1]*i[2]-i[1]*t[2],t[2]*i[0]-i[2]*t[0],t[0]*i[1]-i[0]*t[1]])}function u(t,i){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]}function _(){return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function p(t,i,s){let e=new Float32Array(16),n=d(s),h=d((o=t,a=i,new Float32Array([o[0]-a[0],o[1]-a[1],o[2]-a[2]])));var o,a;let r=d(c(n,h)),l=d(c(h,r));return e[0]=r[0],e[1]=l[0],e[2]=h[0],e[3]=0,e[4]=r[1],e[5]=l[1],e[6]=h[1],e[7]=0,e[8]=r[2],e[9]=l[2],e[10]=h[2],e[11]=0,e[12]=-u(r,t),e[13]=-u(l,t),e[14]=-u(h,t),e[15]=1,e}function g(t,i){let s=new Float32Array(16);return s[0]=t[0]*i[0]+t[4]*i[1]+t[8]*i[2]+t[12]*i[3],s[4]=t[0]*i[4]+t[4]*i[5]+t[8]*i[6]+t[12]*i[7],s[8]=t[0]*i[8]+t[4]*i[9]+t[8]*i[10]+t[12]*i[11],s[12]=t[0]*i[12]+t[4]*i[13]+t[8]*i[14]+t[12]*i[15],s[1]=t[1]*i[0]+t[5]*i[1]+t[9]*i[2]+t[13]*i[3],s[5]=t[1]*i[4]+t[5]*i[5]+t[9]*i[6]+t[13]*i[7],s[9]=t[1]*i[8]+t[5]*i[9]+t[9]*i[10]+t[13]*i[11],s[13]=t[1]*i[12]+t[5]*i[13]+t[9]*i[14]+t[13]*i[15],s[2]=t[2]*i[0]+t[6]*i[1]+t[10]*i[2]+t[14]*i[3],s[6]=t[2]*i[4]+t[6]*i[5]+t[10]*i[6]+t[14]*i[7],s[10]=t[2]*i[8]+t[6]*i[9]+t[10]*i[10]+t[14]*i[11],s[14]=t[2]*i[12]+t[6]*i[13]+t[10]*i[14]+t[14]*i[15],s[3]=t[3]*i[0]+t[7]*i[1]+t[11]*i[2]+t[15]*i[3],s[7]=t[3]*i[4]+t[7]*i[5]+t[11]*i[6]+t[15]*i[7],s[11]=t[3]*i[8]+t[7]*i[9]+t[11]*i[10]+t[15]*i[11],s[15]=t[3]*i[12]+t[7]*i[13]+t[11]*i[14]+t[15]*i[15],s}class m{constructor(){this.vpHeight=0,this.vpWidth=0,this._projectionMatrix=_(),this._viewMatrix=_(),this._vpMatrix=_(),this._pendingMatrixUpdates=!0,this.isOrtho=!0,this.near=-5e3,this.far=5e3}get viewProjectionMatrix(){return this.update(),this._vpMatrix}get hasPendingUpdates(){return this._pendingMatrixUpdates}setViewport(t,i){this.vpWidth=t,this.vpHeight=i,this._pendingMatrixUpdates=!0}setPerspective(){let t=this.vpWidth/this.vpHeight;this._projectionMatrix=function(t,i,s,e){let n=1/Math.tan(t/2);return new Float32Array([n/i,0,0,0,0,n,0,0,0,0,(e+s)/(s-e),-1,0,0,2*e*s/(s-e),0])}(45*Math.PI/180,t,1,100),this.isOrtho=!1,this._pendingMatrixUpdates=!0}setOrtho(){this._projectionMatrix=function(t,i,s,e,n,h){let o=i-t,a=e-s,r=h-n;return new Float32Array([2/o,0,0,-(i+t)/o,0,2/a,0,-(e+s)/a,0,0,-2/r,-(h+n)/r,0,0,0,1])}(-this.vpWidth/2,this.vpWidth/2,-this.vpHeight/2,this.vpHeight/2,this.near,this.far),this.isOrtho=!0,this._pendingMatrixUpdates=!0}lookAt(t,i,s){this._viewMatrix=p(t,i,s),this._pendingMatrixUpdates=!0}update(){this._pendingMatrixUpdates&&(this.isOrtho?this.setOrtho():this.setPerspective(),this._vpMatrix=g(this._projectionMatrix,this._viewMatrix),this._pendingMatrixUpdates=!1)}}class v{constructor(t,i){this._canvas=t,this.gl=null,this.width=0,this.height=0,this._density=1,this._sceneController=i,this._scene=[],this._camera=null,this._mvpMatrix=_,this._isRunning=!1,this._delayedResizing=null,this._bg=[0,0,0,0],this.init()}init(){try{this.gl=this._canvas.getContext("webgl")}catch(t){console.log("cannot create webgl context")}this._camera=new m,this._camera.setOrtho(),this._camera.lookAt([0,0,1e3],[0,0,0],[0,1,0]),window.addEventListener("resize",(()=>this.resize()),!1)}get density(){return this._density}get canvas(){return this._canvas}get context(){return this.gl}get bgColor(){return this._bg}set bgColor(t){this._bg=t,this._bg[3]=1}clearScene(){this._scene=[]}addSceneNode(t){t.init(this.gl),this._scene.push(t)}start(){this._isRunning||(this._isRunning=!0,i.animate(this))}stop(){this._isRunning&&(this._isRunning=!1,i.release(this),this.gl.clearColor(this._bg[0],this._bg[1],this._bg[2],this._bg[3]),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT))}update(t){if(null!=this._sceneController&&this._sceneController.update(t),this._isRunning)for(var i of(this.gl.blendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.enable(this.gl.BLEND),this.gl.disable(this.gl.DEPTH_TEST),this.clearCanvas(),this._scene))(i.hasPendingUpdates||this._camera.hasPendingUpdates)&&(this._mvpMatrix=g(this._camera.viewProjectionMatrix,i.modelMatrix)),i.shader.program?(i.shader.useProgram(),i.shader.bindTexture(i.texture.glTexture),i.shader.mvpMatrix=this._mvpMatrix,i.shader.opacity=i.opacity,i.shader.center=[i.position[0],i.position[1]],i.shader.resolution=[this.width,this.height],i.draw(this.gl)):console.log("Invalid shader program")}clearCanvas(){this.gl.clearColor(this._bg[0],this._bg[1],this._bg[2],this._bg[3]),this.gl.clear(this.gl.COLOR_BUFFER_BIT)}resize(i=!1){this._density=t.retina?2:1;let s=t.vpw*this._density,e=t.vph*this._density;!i&&t.mobile&&this.width==s&&Math.abs(this.height-e)<300||(this.width=s,this.height=e,this._canvas.width=this.width,this._canvas.height=this.height,this._canvas.style.width=t.vpw+"px",this._canvas.style.height=t.vph+"px",i?this.resizeViewport():(null!=this._delayedResizing&&clearTimeout(this._delayedResizing),this._delayedResizing=setTimeout((()=>{this._delayedResizing=null,this.resizeViewport()}),100)))}resizeViewport(){this.gl.viewport(0,0,this.width,this.height),this._camera.setViewport(this.width,this.height),this._sceneController.surfaceDidChange(this.width,this.height,this._density)}}const f="\n    attribute vec3 position; \n    attribute vec2 texcoord; \n    attribute vec2 quadsize; \n\n    uniform mat4 mvpMatrix;\n    varying vec2 vUV;\n    varying float vWH;\n\n    void main() \n    { \n        gl_Position = mvpMatrix * vec4( position, 1.0 ); \n        vUV = texcoord;\n        vWH = quadsize.x / quadsize.y;\n    }\n",b="\n    // Raster shader by Christophe da Silva\n    // Do whatever you want with this code\n    precision lowp float; // or lowp\n\n    uniform float opacity;  \n    uniform vec2 center; \n    uniform float radius;   \n    uniform vec2 resolution; \n    uniform vec2 offset; \n    uniform sampler2D texture;\n    \n    varying vec2 vUV;\n    varying float vWH;\n\n   vec4 baseColor = vec4( 208.0/255.0,     208.0/255.0,     218.0/255.0,  1.0); \n   float scale = 20.0;\n\n    float distToRect(vec2 center, vec2 size, vec2 pt)\n    {\n        float dx = max(abs(pt.x - center.x) - size.x / 2.0, 0.0);\n        float dy = max(abs(pt.y - center.y) - size.y / 2.0, 0.0);\n        return sqrt(dx * dx + dy * dy);\n    }\n\n    void main( void )\n    {         \n        // Use UV coords scaled to quad aspect ratio to know position in quad\n        float quadHeight = (1.0 / vWH);\n        float segLength = quadHeight - 2.0;  // Adding end spacing for rounded corners\n        vec2 quadPos = vec2(vUV.x, vUV.y / vWH);\n        \n        // Normalized position in disc, 0.0 as center\n        float dx = (gl_FragCoord.x - resolution.x/2.0 - center.x) / radius;\n        float dy = (gl_FragCoord.y - resolution.y/2.0 - center.y) / radius;\n        float toCenter = sqrt(dx * dx + dy * dy);\n\n        // Magnyfying lense\n        float angle = atan(dy, dx);\n        float distortion = pow(toCenter, 0.8) * toCenter;\n        vec2 warp = vec2(distortion * cos(angle),distortion * sin(angle));\n\n        // Texture position\n        vec2 tpos = vec2(0.55,0.0) + offset + warp / scale;\n\n        // Noise from texture \n        float noise = texture2D(texture, tpos).x;\n        noise = min(1.0,max(0.0,(noise * 1.2 - 0.1)));\n\n        // Base thickness\n        float toCore = distToRect( vec2(0.5, quadHeight / 2.0), vec2(0.0, segLength ), quadPos);\n        float thick =  (opacity*0.8) - toCore;\n\n        // Thicken circle border \n        thick = thick * 1.0-smoothstep( 0.99, 1.01, toCenter);\n\n        // Noise based thickness\n        thick = smoothstep(noise * 0.7, 0.7 + noise * 0.3   , thick);\n\n        // harden stripes\n        thick = smoothstep(0.0,  1.0, thick);\n\n        // Final color\n        gl_FragColor = vec4(baseColor.xyz, thick * opacity * baseColor.w);// vec4(baseColor.xyz, thick * opacity * baseColor.w);\n\n        // Premultiply canvas output\n        gl_FragColor.rgb *= gl_FragColor.a;\n    }\n";class y{constructor(t){this.gl=t,this._program=this.createProgram(t,f,b),this._matrixLocation=this.gl.getUniformLocation(this._program,"mvpMatrix"),this._opacityLocation=this.gl.getUniformLocation(this._program,"opacity"),this._resolutionLocation=this.gl.getUniformLocation(this._program,"resolution"),this._centerLocation=this.gl.getUniformLocation(this._program,"center"),this._radiusLocation=this.gl.getUniformLocation(this._program,"radius"),this._offsetLocation=this.gl.getUniformLocation(this._program,"offset"),this._textureLocation=this.gl.getUniformLocation(this._program,"texture")}get program(){return this._program}useProgram(){this.gl.useProgram(this._program)}bindTexture(t){this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,t),this.gl.uniform1i(this._textureLocation,0)}set mvpMatrix(t){this.gl.uniformMatrix4fv(this._matrixLocation,!1,t)}set opacity(t){this.gl.uniform1f(this._opacityLocation,t)}set resolution(t){this.gl.uniform2f(this._resolutionLocation,t[0],t[1])}set radius(t){this.gl.uniform1f(this._radiusLocation,t)}set center(t){this.gl.uniform2f(this._centerLocation,t[0],t[1])}set texOffset(t){this.gl.uniform2f(this._offsetLocation,t[0],t[1])}createProgram(t,i,s){var e=t.createProgram(f,b),n=this.createShader(t,i,t.VERTEX_SHADER),h=this.createShader(t,"#ifdef GL_ES\nprecision highp float;\n#endif\n\n"+s,t.FRAGMENT_SHADER);return null==n||null==h?null:(t.attachShader(e,n),t.attachShader(e,h),t.deleteShader(n),t.deleteShader(h),t.bindAttribLocation(e,0,"position"),t.bindAttribLocation(e,1,"texcoord"),t.bindAttribLocation(e,2,"quadsize"),t.linkProgram(e),t.getProgramParameter(e,t.LINK_STATUS)?e:(console.log("ERROR:\nVALIDATE_STATUS: "+t.getProgramParameter(e,t.VALIDATE_STATUS)+"\nERROR: "+t.getError()+"\n\n- Vertex Shader -\n"+i+"\n\n- Fragment Shader -\n"+s),null))}createShader(t,i,s){var e=t.createShader(s);return t.shaderSource(e,i),t.compileShader(e),t.getShaderParameter(e,t.COMPILE_STATUS)?e:(console.log((s==t.VERTEX_SHADER?"VERTEX":"FRAGMENT")+" SHADER:\n"+t.getShaderInfoLog(e)),null)}}class w extends class{constructor(){this.shader=null,this.texture=null,this._opacity=1,this._rotation=[0,0,0],this._position=[0,0,0],this.mtrans=_(),this.mrot=_(),this._mMatrix=_(),this._pendingMatrixUpdates=!1,this._pendingRenderUpdates=!1}get hasPendingUpdates(){return this._pendingRenderUpdates}get position(){return this._position}set position(t){this.translate(t[0],t[1],t[2])}get opacity(){return this._opacity}set opacity(t=1){this._opacity=t}get modelMatrix(){return this.updateMatrix(),this._mMatrix}init(t){}rotate(t,i,s){this._rotation[0]==t&&this._rotation[1]==i&&this._rotation[2]==s||(this._rotation=[t,i,s],this.mrot=function(t){let i=_(),s=_(),e=_();return i[5]=Math.cos(t[0]),i[6]=-Math.sin(t[0]),i[9]=Math.sin(t[0]),i[10]=Math.cos(t[0]),s[0]=Math.cos(t[1]),s[2]=Math.sin(t[1]),s[8]=-Math.sin(t[1]),s[10]=Math.cos(t[1]),e[0]=Math.cos(t[2]),e[1]=-Math.sin(t[2]),e[4]=Math.sin(t[2]),e[5]=Math.cos(t[2]),g(i,g(s,e))}([t,i,s]),this._pendingMatrixUpdates=!0,this._pendingRenderUpdates=!0)}translate(t,i,s){var e;this._position[0]==t&&this._position[1]==i&&this._position[2]==s||(this._position=[t,i,s],this.mtrans=(e=[t,i,s],new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,e[0],e[1],e[2],1])),this._pendingMatrixUpdates=!0,this._pendingRenderUpdates=!0)}updateMatrix(){this._pendingMatrixUpdates&&(this._mMatrix=g(this.mtrans,this.mrot),this._pendingMatrixUpdates=!1)}draw(t){this._pendingRenderUpdates=!1}}{constructor(){super(),this._lines=[],this._ratios=[],this._stepSize=4,this._entropy=0,this._vbo=null,this._vbo_stride=7,this._vbo_need_updates=!0,this._radius=300,this._pixeldensity=1}get radius(){return this._radius}set radius(t=300){this._radius=t,this.reset()}get stepSize(){return this._stepSize}set stepSize(t=5){this._stepSize=t,this.reset()}setPixelDensity(t=1){this._pixeldensity=t,this._radius=this._radius}get entropy(){return this._entropy}set entropy(t=1){this._entropy!=t&&(this._entropy=t,this.generateLines())}reset(){this._linecount=2*Math.ceil(this._radius/this._stepSize),this._vdata=new Float32Array(6*this._linecount*this._vbo_stride),this.generateLines()}generateLines(){this.generateLinesRasters()}generateLinesRasters(){this._lines=[];let t=this._radius*this._radius,i=-this._radius;for(var s=0;s<this._linecount;s++){let e=Math.sqrt(t-i*i);this._lines[s]=[[i,e],[i,-e]],i+=this._stepSize}this._vbo_need_updates=!0}generateRatios(){for(var t=0;t<this._linecount;t++){let i=-1*(-1.9*Math.random()+.1);this._ratios[t]=i}}generateTriangles(t){if(!this._vbo_need_updates)return;this._vbo_need_updates=!1;let i=0,s=this._stepSize/2*this._pixeldensity;for(var e of this._lines){let t=e[0],n=e[1],h=2*s,o=Math.abs(t[1]-n[1])*this._pixeldensity;this._vdata[i]=n[0]*this._pixeldensity-s,this._vdata[i+1]=n[1]*this._pixeldensity,this._vdata[i+2]=0,this._vdata[i+3]=0,this._vdata[i+4]=1,this._vdata[i+5]=h,this._vdata[i+6]=o,i+=this._vbo_stride,this._vdata[i]=n[0]*this._pixeldensity+s,this._vdata[i+1]=n[1]*this._pixeldensity,this._vdata[i+2]=0,this._vdata[i+3]=1,this._vdata[i+4]=1,this._vdata[i+5]=h,this._vdata[i+6]=o,i+=this._vbo_stride,this._vdata[i]=t[0]*this._pixeldensity-s,this._vdata[i+1]=t[1]*this._pixeldensity,this._vdata[i+2]=0,this._vdata[i+3]=0,this._vdata[i+4]=0,this._vdata[i+5]=h,this._vdata[i+6]=o,i+=this._vbo_stride,this._vdata[i]=n[0]*this._pixeldensity+s,this._vdata[i+1]=n[1]*this._pixeldensity,this._vdata[i+2]=0,this._vdata[i+3]=1,this._vdata[i+4]=1,this._vdata[i+5]=h,this._vdata[i+6]=o,i+=this._vbo_stride,this._vdata[i]=t[0]*this._pixeldensity+s,this._vdata[i+1]=t[1]*this._pixeldensity,this._vdata[i+2]=0,this._vdata[i+3]=1,this._vdata[i+4]=0,this._vdata[i+5]=h,this._vdata[i+6]=o,i+=this._vbo_stride,this._vdata[i]=t[0]*this._pixeldensity-s,this._vdata[i+1]=t[1]*this._pixeldensity,this._vdata[i+2]=0,this._vdata[i+3]=0,this._vdata[i+4]=0,this._vdata[i+5]=h,this._vdata[i+6]=o,i+=this._vbo_stride}t.bindBuffer(t.ARRAY_BUFFER,this._vbo),t.bufferData(t.ARRAY_BUFFER,this._vdata,t.STATIC_DRAW)}init(t){super.init(t),this._vbo=t.createBuffer(),this.reset(),this.generateLines(),this.generateTriangles(t)}draw(t){super.draw(t),this.generateTriangles(t),t.bindBuffer(t.ARRAY_BUFFER,this._vbo),t.vertexAttribPointer(0,3,t.FLOAT,!1,28,0),t.enableVertexAttribArray(0),t.vertexAttribPointer(1,2,t.FLOAT,!0,28,12),t.enableVertexAttribArray(1),t.vertexAttribPointer(2,2,t.FLOAT,!0,28,20),t.enableVertexAttribArray(2),t.drawArrays(t.TRIANGLES,0,6*this._lines.length),t.disableVertexAttribArray(undefined)}v2add(t,i){return[t[0]+i[0],t[1]+i[1]]}}class x{constructor(t,i){this._gl_texture=null,this.gl=t,this.url=i,this._isLoaded=!1,this.load(this.gl)}get glTexture(){return this._gl_texture}get isLoaded(){return this._isLoaded}load(t){this._gl_texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this._gl_texture);const i=new Uint8Array([255,0,0,255]);t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,i);const s=new Image;s.onload=()=>{t.bindTexture(t.TEXTURE_2D,this._gl_texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,s),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.MIRRORED_REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.MIRRORED_REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),this._isLoaded=!0},s.src=this.url}isPowerOf2(t){return 0==(t&t-1)}}const T={loading:Symbol("loading"),splash:Symbol("splash"),default:Symbol("default"),focus:Symbol("focus"),scrolling:Symbol("scrolling"),outro:Symbol("outro"),sleep:Symbol("sleep")};Object.freeze(T);class E extends class{constructor(){}update(t){}surfaceDidChange(t,i,s){}}{constructor(t){super(),this._overlays=null,this.renderer=new v(t,this),this.shape=new w,this.gl=null,this._isRunning=!1,this._state=T.loading,this._isOverlayActive=!1,this._maxOpacity=1,this.visibility=0,this.textopacity=0,this.pixelOffset=0,this.pointer=[0,0],this.focusvalue=0,this._isHovering=!1,this._hoverDidChange=!1,this.browserWidth=0,this.browserHeight=0,this.shapeY=0,this.shapeX=0,this.originY=0,this.moveRange=[-180,180],this._elapsedTime=0,this._lastHoverTime=0}get isRunning(){return this._isRunning}get readyToRun(){return this.shape.texture.isLoaded&&this._elapsedTime>50}get isFocus(){return this._state==T.focus}set overlays(t){Array.isArray(t)?this._overlays=t:this._overlays=[t],this._overlays.forEach((t=>{t.addEventListener("mouseover",(t=>{this._isOverlayActive=!0}),!1),t.addEventListener("mouseout",(t=>{this._isOverlayActive=!1}),!1)})),this.updateOpacities()}resetOverlays(){if(null!=this._overlays)for(var t of this._overlays)t.style.opacity="initial"}init(){this.gl=this.renderer.context,this.shape.shader=new y(this.gl),this.shape.texture=new x(this.gl,location.protocol+"/img/noise.jpg"),this.renderer.clearScene(),this.renderer.addSceneNode(this.shape),this.renderer.resize(!0),this.reset()}reset(){this._state=T.loading,this._isRunning=!1,this.easeVis=null,this.easeAnim=null,this.easeHover=null,this.easeText=null,this._elapsedTime=0,this.visibility=0,this.focusvalue=0,this.textopacity=0,this.texOffset=[0,.01],this.updateOpacities()}run(){this._isRunning||(this._isRunning=!0,this._pendingRun=!0,this.renderer.start())}runTransition(){this._isRunning&&(this._pendingRun=!1,this.nextState(this._state))}default(){this.toState(T.default)}scrolling(t=1){this.toState(T.scrolling),this.moveUp(t)}outro(){this.toState(T.outro)}focus(){this.toState(T.focus)}sleep(){this.toState(T.sleep)}deepSleep(){this.renderer.stop(),this._isRunning=!1,this.easeAnim=null,this.easeHover=null,this.lower(),this.focusOff(!1),this.update(.17)}refresh(t=!0){this.toState(this._state,t)}toState(i,s=!0){if(this._state==i&&s)return;let e=this._state;if(this._state=i,this._state==T.splash){this.visibility=0,this.textopacity=0,this.shapeY=this.originY-this.moveRange;const t=1.6;this.appear(t),this.center(s,t),this.focusOn(),this.focusvalue=1}else this._state==T.default?(this.appear(),this.center(s),this.focusOff(),this.textAppear(t.mobile?.8:1)):this._state==T.focus?(this.center(s),this.focusOn(),this.textDisappear(.6,.15)):this._state==T.outro?(this.appear(),this.focusOff(),this.right()):this._state==T.sleep&&(this.visibility=e!=T.loading?this._maxOpacity:0,this.disappear(s?.8:.2),this.focusOff(),this.resetOverlays());this.updateOpacities()}nextState(t){t==T.loading?this.toState(T.splash):(t==T.splash||t!=T.scrolling&&t!=T.outro)&&this.toState(T.default)}appear(t=.8){this.visibility<this._maxOpacity&&(this.easeVis=new s(this,"visibility",this.visibility,this._maxOpacity,t,"quart-ease-out"))}disappear(t=.8){this.easeVis=new s(this,"visibility",this.visibility,0,t,"ease-out")}textAppear(t=.8){this.easeText=new s(this,"textopacity",this.textopacity,1,t,"ease-in-out")}textDisappear(t=.8,i=0){this.easeText=new s(this,"textopacity",this.textopacity,i,t,"ease-out")}focusOn(t=!0){this.easeHover=new s(this,"focusvalue",this.focusvalue,1,.8,"ease-out")}focusOff(t=!0){this.easeHover=new s(this,"focusvalue",this.focusvalue,0,1,"ease-in-out")}lower(){this.shapeY=this.originY-this.moveRange}center(t=!0,i=.8){(this.shapeY<this.originY||this.shapeY>this.originY)&&t?this.easeAnim=new s(this,"shapeY",this.shapeY,this.originY,i,"quart-ease-out"):this.shapeY=this.originY,this.shapeX=0}right(t=!0,i=.8){this.shapeX=this.shape.radius,this.shapeY=0}moveUp(t,i=!0,e=.2){if(i){let i=this.moveRange*(1-t);this.easeAnim=new s(this,"shapeY",this.shapeY,this.originY+i,e,"linear")}else this.shapeY=this.originY+this.moveRange;this.shapeX=0}update(i){if(this._elapsedTime+=i,this._pendingRun){if(!this.readyToRun)return;this.runTransition()}if(this.updateEasings(i),t.touchdevice)this.texOffset[0]=Math.cos(this._elapsedTime/8e3)/5,this.texOffset[1]=Math.sin(.2+this._elapsedTime/6e3)/5;else{let t=this.pointer[0]-this.browserWidth/2+this.shape.position[0],i=this.pointer[1]-this.browserHeight/2+this.shape.position[1],s=5e3,e=Math.max(-1.5,Math.min(1.5,t/this.shape.radius))/s,n=Math.max(-1.5,Math.min(1.5,-i/this.shape.radius))/s;if(this.texOffset[0]+=e,this.texOffset[1]+=n,this._state==T.default||this._state==T.focus){let s=Math.sqrt(t*t+i*i)/this.shape.radius<1&&!this._isOverlayActive;this.delayedHovering(s,100)}}this.updateScene(),this.updateOpacities(),this.shape.shader.texOffset=this.texOffset,this.shape.shader.radius=this.shape.radius*this.renderer.density}updateScene(){this.shape.translate(this.shapeX*this.renderer.density,this.shapeY*this.renderer.density,0);let t=(this.originY-this.shapeY)/this.moveRange;this.shape.rotate(0,0,.1+.2*t)}updateOpacities(){const i=t.mobile?.82:.8;if(this._state==T.splash?this.shape.opacity=i+.12:this.shape.opacity=i+.12*this.focusvalue,this.shape.opacity*=this.visibility,this._overlays)for(var s of this._overlays)s.style.opacity=this.textopacity}delayedHovering(t,i){this._isHovering!=t&&(this._lastHoverTime=this._elapsedTime,this._isHovering=t,this._hoverDidChange=!0),this._hoverDidChange&&this._elapsedTime-this._lastHoverTime>i&&(t?this.toState(T.focus):this.toState(T.default))}updateEasings(t){null!=this.easeVis&&(this.easeVis.update(t),this.easeVis.isDone&&(this.easeVis=null,this._state==T.sleep?this.deepSleep():this.nextState(this._state))),null!=this.easeAnim&&(this.easeAnim.update(t),this.easeAnim.isDone&&(this.easeAnim=null)),null!=this.easeHover&&(this.easeHover.update(t),this.easeHover.isDone&&(this.easeHover=null)),null!=this.easeText&&(this.easeText.update(t),this.easeText.isDone&&(this.easeText=null))}surfaceDidChange(i,s,e){this.shape.setPixelDensity(e),this._maxOpacity=.8,this.browserWidth=i/e,this.browserHeight=s/e;const n=2048;let h=Math.min(this.browserHeight,n);this.shape.radius=(h-80-80)/2,this.browserWidth<this.browserHeight&&(this.browserWidth>760?this.shape.radius=Math.min(944,(this.browserWidth-96)/2):this.shape.radius=(this.browserWidth-40)/2),this.shape.radius=Math.min(432,this.shape.radius),this.originY=this.browserHeight>n?(this.browserHeight-n)/2:0,this.moveRange=.8*this.shape.radius,this.shapeY=this.originY-this.moveRange,this.shapeX=0,this.shape.stepSize=t.mobile?4:e>1?5:6,this.pixelOffset=0;let o=this.browserWidth/2-this.shape.radius,a=o-Math.floor(o)==0;e<=1?this.pixelOffset=a?.5:0:e>1&&(this.pixelOffset=0),this.updateScene(),this.refresh(!1)}}const S=t=>new Promise((i=>setTimeout(i,t))),L=t.mobile?256:384,A=t.mobile?36:96;const R=new class extends class{constructor(){}onScroll(t){}onMouseMove(t){}onTouchStart(t){}onTouchEnd(t){}onResize(t){}}{constructor(){super(),this.body=null,this.canvas=null,this.container=null,this.footer=null,this.lazyReveal=null,this.intro=null,this.cover=null,this.about=null,this.nav=null,this.currentView=null,this.isContentLoading=!1,this.isInAboutTransition=!1,this.isInScrollTransition=!1,this.isScrollLocked=!1,this.touchTimer=null,this.booted=!1,this.infoPos=0,this.outroLightTrigger=5e3,this.titlePrefix="Christophe da Silva — ",this.views={index:{path:"/index.html",title:"Product Designer",darkmode:!0,intro:!0},about:{path:"/about.html",title:"About",darkmode:!0,intro:!1},aic:{path:"/work/aic.html",title:"Art Institute of Chicago",darkmode:!0,intro:!1},phallaina:{path:"/work/phallaina.html",title:"Phallaina",darkmode:!0,intro:!1},"precision-run":{path:"/work/precision-run.html",title:"Precision Run",darkmode:!0,intro:!1},rookery:{path:"/work/rookery.html",title:"rookery",darkmode:!0,intro:!1},nytco:{path:"/work/nytco.html",title:"The New York Time Company",darkmode:!0,intro:!1},pup:{path:"/work/pup.html",title:"Princeton University Press",darkmode:!0,intro:!1},404:{path:"404.html",title:"Page not found",darkmode:!0,intro:!1}}}get isIndex(){return this.currentView.path.includes("index")}get hasIntro(){return!(null===this.intro||!this.currentView.intro)&&this.isIndex}get isIntroVisible(){return this.input.scrollPos<=L}get isIntroScrolling(){return this.input.scrollPos>=A}get isOutroVisible(){return!1}run(){this.body=document.getElementsByTagName("body")[0],this.canvas=document.getElementById("renderer"),this.container=document.getElementById("container"),this.footer=document.getElementsByTagName("footer")[0],this.currentView=this.getViewInfo(document.location.href),history.replaceState({view:this.currentView},this.titlePrefix+this.currentView.title,this.currentView.path),window.addEventListener("popstate",(t=>this.popState(t.state))),t.update(),this.lazyReveal=new o(this.container),this.nav=new l,this.input=new h(this),this.eventBus=new n((t=>{this.onEvent(t)})),this.about=new a(this.eventBus),void 0!==this.canvas&&null!=this.canvas&&(this.intro=new E(this.canvas),this.intro.init()),this.syncDOM(),this.boot()}boot(){this.booted||(this.booted=!0,this.isIndex&&setTimeout((()=>{this.nav.preview()}),300),this.onEvent("load"))}syncDOM(){if(this.resetAbout(),this.nav.init(),this.nav.indexMode=this.isIndex,this.isIndex){setTimeout((()=>{this.about.load()}),500),this.cover=document.getElementById("cover");let i=Array.from(this.cover.getElementsByClassName("over"));this.intro.overlays=i,t.touchdevice||this.cover.addEventListener("click",(t=>{t.preventDefault(),this.intro.isFocus&&this.scrollToContent()}),!1),Array.from(this.cover.getElementsByTagName("A")).forEach((t=>{t.addEventListener("click",(i=>{i.preventDefault(),t.classList.contains("gotowork")?this.scrollToContent():this.toggleAbout()}),!1)}))}this.syncRouting(),this.syncKeyScrollPositions(),this.lazyReveal.init()}resetAbout(){this.about.init(t.vph),this.about.embed=this.isIndex&&!t.mobile}onScroll(t){if(!this.isContentLoading&&(this.isInAboutTransition||(this.nav.update(this.input.scrollPos),this.updateBGColor()),this.hasIntro)){let t=L-this.input.scrollPos;this.isInScrollTransition||this.isInAboutTransition||(this.input.scrollPos>=L?this.hideCover():this.showCover()),this.isIntroVisible?this.isIntroScrolling?this.intro.scrolling(t/L):this.input.isScrollingUp&&this.intro.default():this.isOutroVisible&&this.intro.outro(),this.runIntro()}}updateBGColor(){if(this.isIndex){let t=L-this.input.scrollPos,i=this.input.scrollPos<this.outroLightTrigger;t<=0&&i?this.body.classList.add("light"):this.body.classList.remove("light")}}runIntro(){this.isIntroVisible||this.isOutroVisible?this.intro.run():this.intro.sleep()}syncKeyScrollPositions(){if(this.nav.indexMode=this.isIndex,this.isIndex){let i=document.getElementById("cover").offsetHeight,s=document.getElementById("features").offsetHeight;this.infoPos=i+s,t.mobile?this.outroLightTrigger=this.infoPos-t.vph-144:(this.outroLightTrigger=this.infoPos-512,this.infoPos-=144),this.nav.encore=this.infoPos-96}}onMouseMove(t){this.intro.pointer=this.input.mousePos}onTouchStart(t){this.hasIntro&&this.isIntroVisible&&(this.touchTimer=setTimeout((()=>{}),150))}onTouchEnd(t){this.hasIntro&&this.isIntroVisible&&(t.didTouchMove||(null!=this.touchTimer&&(clearTimeout(this.touchTimer),this.touchTimer=null),this.scrollToContent()))}didResize(t){null!=this.about?(this.resetAbout(),this.about.isVisible()||this.enableScroll()):this.enableScroll(),this.nav.init(),this.nav.indexMode=this.isIndex,this.syncKeyScrollPositions()}onEvent(t){this.isContentLoading||("load"==t&&this.hasIntro&&this.isIntroVisible&&(this.intro.reset(),this.intro.canFocusInteract=this.input.scrollPos<A,this.runIntro(),this.isInScrollTransition=!1),"about.show"==t?this.showAbout():"about.hide"==t&&this.hideAbout(),"nav.hide"==t?this.nav.hide():"nav.show"==t?this.nav.full():"nav.preview"==t?this.nav.preview():"nav.backbutton"==t?this.nav.setBackButton(!0):"nav.nobackbutton"==t&&this.nav.setBackButton(!1))}showCover(){this.cover.classList.contains("hide")&&this.cover.classList.remove("hide")}hideCover(){this.cover.classList.contains("hide")||this.cover.classList.add("hide")}toggleAbout(){this.about.isVisible()?this.hideAbout():this.showAbout()}showAbout(){this.about.embed?(this.isInAboutTransition=!0,this.hideCover(),this.syncKeyScrollPositions(),e.scrollTo(this.infoPos,1),this.nav.setBackButton(!0),this.trackPageView(this.getViewInfo("about")),setTimeout((()=>{this.isInAboutTransition=!1}),800)):(this.body.classList.remove("light"),this.isInAboutTransition=!0,this.about.lock(),this.trackPageView(this.getViewInfo("about")),this.lockScroll(),setTimeout((()=>{this.nav.indexMode=!1,this.nav.light(),this.nav.full()}),200))}hideAbout(){this.about.embed?(this.isInAboutTransition=!0,e.scrollTo(0,1),setTimeout((()=>{this.isInAboutTransition=!1}),800)):(this.isInAboutTransition=!1,this.updateBGColor(),this.about.hide(),this.enableScroll(),this.nav.unlight(),this.nav.indexMode=this.isIndex,this.nav.update(this.input.scrollPos)),this.isIndex&&this.intro.refresh()}lockScroll(){this.isScrollLocked||(document.body.style.overflow="hidden",this.isScrollLocked=!0)}enableScroll(){this.isScrollLocked&&(document.body.style.overflow="visible",this.isScrollLocked=!1)}syncRouting(){this.nav.setBackButton(this.currentView.path.includes("about")),this.rewireSublinks(this.nav.element),this.rewireContentLinks()}rewireContentLinks(){Array.from(this.container.getElementsByClassName("content")).forEach((t=>{this.rewireSublinks(t)}))}rewireSublinks(t){let i=new RegExp(location.host);Array.from(t.getElementsByTagName("A")).forEach((t=>{var s=t.href;!i.test(s)||s.includes("#")||"_blank"==t.target||t.classList.contains("applink")||(t.classList.add("applink"),t.addEventListener("click",(t=>{t.preventDefault();let i=t.currentTarget.href;this.pushState(i)}),!1))}))}scrollToContent(){const i=t.mobile?-4:128;this.hideCover(),this.isInScrollTransition=!0,e.scrollTo(Math.min(2048,t.vph)+i,.8),setTimeout((()=>{this.isInScrollTransition=!1}),600)}getViewInfo(t){let i=t.replace(/^.*[\\\/]/,"");i=i.replace(".html","");let s=this.views[i];return void 0===s&&(s=this.views.index),s}pushState(t){let i=this.getViewInfo(t);return i.path.includes("about")?this.currentView.path.includes("about")?(history.back(),!1):(this.toggleAbout(),!1):(this.enableScroll(),this.switchView(i),history.pushState({view:i},this.titlePrefix+i.title,i.path),this.trackPageView(i),!1)}popState(t){let i;null!=t&&(i=t.view,void 0===i&&(i=this.views[0]),this.switchView(i))}trackPageView(t){"undefined"!=typeof gtag&&(gtag("config","UA-543852-7",{page_path:t.path}),gtag("event","page_view",{send_to:"UA-543852-7"}))}switchView(t){if(null==t)return!1;this.isContentLoading=!0,this.beginViewTransition(t),S(400).then((()=>{fetch(t.path,{headers:{"Content-Type":"text/html; charset=utf-8"}}).then((t=>t.text())).then((i=>{var s=(new DOMParser).parseFromString(i,"text/html");this.updateDocument(t,s),this.isContentLoading=!1,S(150).then((()=>{this.finishViewTransition(t)}))})).catch((i=>{console.error("Error while fetching "+t.path+" "+i),this.isContentLoading=!1,this.finishViewTransition(t)}))}))}updateDocument(t,i){this.currentView=t,this.about.removeContent(),Array.from(document.getElementsByClassName("content")).forEach((t=>{this.container.removeChild(t)})),this.isInScrollTransition=!0,window.scrollTo(0,0),document.title=i.title;var s=Array.from(i.getElementsByClassName("content")),e=this.nav.element.nextSibling;s.forEach((t=>{t.classList.add("hide"),this.container.insertBefore(t,e)})),this.syncDOM(),S(50).then((()=>{this.reloadVieos()}))}reloadVieos(){Array.from(document.getElementsByTagName("video")).forEach((i=>{let s=[];for(;i.firstChild;){let t=i.firstChild;null!=t&&"SOURCE"==t.tagName&&s.push([t.src,t.type]),i.removeChild(t)}s.forEach((t=>{let s=document.createElement("source");s.src=t[0],s.type=t[1],i.appendChild(s)})),i.autoplay=!0,i.muted=!0,i.playsinline=!0,t.mobile&&(i.controls=!0,i.addEventListener("touchstart",(t=>i.play())))}))}beginViewTransition(t){this.about.isVisible()&&this.hideAbout(),Array.from(document.getElementsByClassName("content")).forEach((t=>{t.classList.add("hide")})),this.body.classList.contains("light")&&this.body.classList.remove("light"),this.nav.indexMode=t.path.includes("index"),this.nav.indexMode&&this.nav.preview(),this.intro.sleep(!1),this.footer.classList.add("hide")}finishViewTransition(t){this.onEvent("load"),Array.from(document.getElementsByClassName("content")).forEach((t=>{t.classList.remove("hide")})),this.footer.classList.remove("hide"),this.input.onResize(),this.resetAbout()}};document.addEventListener("DOMContentLoaded",(t=>R.run()))})();